/* General View Styles */
.version-control-view {
    padding: 0;
}

.version-control-content {
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: var(--size-4-2);
    overflow: hidden;
    position: relative; /* For overlaying processing state */
}

/* NEW: Global processing state to prevent concurrent actions */
.version-control-content.is-processing {
    cursor: wait;
}
.version-control-content.is-processing::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--background-primary);
    opacity: 0.5;
    z-index: 100;
}
.version-control-content.is-processing button,
.version-control-content.is-processing input,
.version-control-content.is-processing .clickable-icon,
.version-control-content.is-processing .v-history-entry.is-list-view,
.version-control-content.is-processing .setting-item-control {
    pointer-events: none;
    opacity: 0.6;
}


.v-main {
    display: grid; /* USE GRID FOR OVERLAYS */
    grid-template-rows: 1fr;
    grid-template-columns: 1fr;
    flex-grow: 1;
    overflow: hidden;
    transition: opacity 0.3s ease;
    padding: var(--size-4-2); /* Add some padding to the main container */
    /* Removed 'gap' as it's not effective for overlaid grid items */
}

/* NEW: This rule stacks all direct children of v-main on top of each other */
.v-main > * {
    grid-row: 1 / -1;
    grid-column: 1 / -1;
    min-width: 0;
    min-height: 0;
}

.v-main.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* REMOVED .v-header and related styles */

.v-placeholder {
    color: var(--text-muted);
    text-align: center;
    padding: var(--size-4-8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--size-4-2);
    flex-grow: 1;
    animation: v-fade-in 0.5s ease;
}

.v-placeholder-icon {
    font-size: 2.5em;
    opacity: 0.5;
}

/* Actions & Settings */
.v-actions-container {
    display: flex;
    flex-direction: column;
    gap: var(--size-4-2);
    flex-shrink: 0;
}

.v-top-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* NEW: Save button style */
.v-top-actions .v-save-button {
    background-color: transparent;
    border: 1px solid var(--interactive-accent);
    color: var(--text-normal);
    padding: var(--size-4-1) var(--size-4-3);
    height: auto;
    box-shadow: none;
    font-weight: var(--font-semibold);
}
.v-top-actions .v-save-button:hover {
    background-color: var(--background-modifier-hover);
    border-color: var(--interactive-accent-hover);
    color: var(--text-normal);
}


.v-name-input-container {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s ease-in-out;
}
.v-name-input-container.is-open {
    grid-template-rows: 1fr;
}
.v-name-input-container > * {
    overflow: hidden;
}
.v-name-input-container input {
    width: 100%;
    margin-bottom: var(--size-4-2);
    animation: v-fade-in 0.3s ease;
}
.v-button-group {
    display: flex;
    gap: var(--size-4-2);
    justify-content: flex-end;
    animation: v-fade-in 0.3s ease;
}

/* NEW: Settings Panel with Grid Animation */
.v-settings-panel {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.35s ease-in-out;
}
.v-settings-panel.is-open {
    grid-template-rows: 1fr;
}
.v-settings-panel-content-wrapper {
    overflow: hidden;
    background-color: var(--background-secondary);
    border-radius: var(--radius-m);
    border: 1px solid var(--background-modifier-border);
    padding: var(--size-4-2);
    margin-top: var(--size-4-2);
}
.v-settings-panel.is-open > .v-settings-panel-content-wrapper {
    overflow-y: auto;
}

.v-settings-actions {
    display: flex;
    justify-content: space-between;
    gap: var(--size-4-2);
    margin-bottom: var(--size-4-2);
    flex-wrap: wrap; /* Allow wrapping for smaller screens */
}
.v-settings-panel .setting-item {
    border: none;
    padding: var(--size-4-2) 0;
    transition: background-color 0.2s ease;
}

/* Version History */
.v-history-view {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.v-history-list-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    position: relative;
}

.v-history-header {
    flex-shrink: 0;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: var(--size-4-2);
    font-size: var(--font-ui-medium);
    padding: var(--size-4-2) 0;
    border-bottom: 1px solid var(--background-modifier-border);
}

.v-history-count {
    font-size: var(--font-ui-smaller);
    color: var(--text-muted);
    margin-left: auto;
    font-weight: normal;
}

.v-history-list {
    flex-grow: 1;
    overflow-y: auto;
    min-height: 0;
    position: relative;
    padding: var(--size-4-2) var(--size-4-1) var(--size-4-2) 0;
    display: flex;
    flex-direction: column;
    gap: var(--size-4-2);
    transition: opacity 0.3s ease;
}

.v-history-list.loading {
    opacity: 0.6;
}

.v-history-entry {
    display: flex;
    flex-direction: column;
    padding: var(--size-4-2); /* Reduced padding */
    border-radius: var(--radius-m);
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    transition: all 0.2s ease;
    position: relative;
    animation: v-fade-in 0.3s ease forwards;
    content-visibility: auto;
    contain: layout style;
    will-change: transform, opacity, border-color, box-shadow;
}
.v-history-entry:hover {
    background-color: var(--background-modifier-hover);
    border-color: var(--interactive-accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-s);
}

.v-entry-header {
    display: flex;
    align-items: center;
    gap: var(--size-4-3);
    margin-bottom: var(--size-4-2);
}
.v-version-id {
    font-weight: 600;
    background-color: var(--interactive-accent);
    color: var(--text-on-accent);
    padding: var(--size-4-1) var(--size-4-2);
    border-radius: var(--radius-s);
    font-size: var(--font-ui-smaller);
}
.v-version-name {
    font-weight: 600;
    font-size: var(--font-ui-small);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 1;
    min-width: 0;
}
.v-version-timestamp {
    font-size: var(--font-ui-smaller);
    color: var(--text-muted);
    margin-left: auto;
    white-space: nowrap;
    flex-shrink: 0;
}
.v-version-content {
    font-size: var(--font-ui-smaller);
    color: var(--text-muted);
}
.v-entry-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--size-4-1);
    margin-top: var(--size-4-3);
    padding-top: var(--size-4-2);
    border-top: 1px solid var(--background-modifier-border);
}
.v-action-btn {
    padding: var(--size-4-2); /* Increased padding for a better click target */
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    border-radius: var(--radius-s);
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: calc(var(--icon-size) + var(--size-4-2) * 2); /* Make it square */
    height: calc(var(--icon-size) + var(--size-4-2) * 2);
}
.v-action-btn:hover {
    background-color: var(--background-modifier-hover);
    color: var(--text-normal);
}
.v-action-btn.danger:hover {
    background-color: var(--background-modifier-error);
    color: var(--text-on-accent);
}

/* List View Mode */
.v-history-entry.is-list-view {
    flex-direction: row;
    align-items: center;
    padding: var(--size-4-2); /* Reduced padding */
    cursor: pointer;
}
.is-list-view .v-entry-header {
    flex-grow: 1;
    margin-bottom: 0;
}
.is-list-view .v-version-content,
.is-list-view .v-entry-footer {
    display: none;
}

/* Inline Panels (Preview, Confirmation) */
.v-panel-container {
    /* flex-grow is removed as it's now a grid item, not a flex item of v-main */
    position: relative;
    display: flex;
    flex-direction: column;
    z-index: 10; /* Ensure panels are on top of the history list */
}

.v-panel-container > .v-inline-panel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-in-out;
    background-color: var(--background-primary);
}

.v-panel-container > .v-inline-panel.is-active {
    opacity: 1;
    pointer-events: auto;
}

.v-inline-panel {
    padding: var(--size-4-2); /* Reduced padding */
    border: 1px solid var(--background-modifier-border);
    border-radius: var(--radius-m);
    display: flex;
    flex-direction: column;
    gap: var(--size-4-3);
    overflow: hidden;
    will-change: opacity;
}
.v-panel-header {
    display: flex;
    align-items: center;
    gap: var(--size-4-3);
}
.v-panel-header h3 {
    margin: 0;
}
.v-confirmation-panel {
    justify-content: center;
    text-align: center;
}
.v-confirmation-panel .modal-buttons {
    display: flex;
    justify-content: center;
    gap: var(--size-4-2);
    margin-top: var(--size-4-2);
}
.v-preview-panel {
    overflow-y: auto;
}
.v-version-metadata {
    display: flex;
    flex-wrap: wrap;
    gap: var(--size-4-4);
    padding-bottom: var(--size-4-3);
    border-bottom: 1px solid var(--background-modifier-border);
}
.v-meta-item {
    display: flex;
    flex-direction: column;
}
.v-meta-label {
    font-size: var(--font-ui-smaller);
    color: var(--text-muted);
    margin-bottom: var(--size-4-1);
}
.v-meta-value {
    font-weight: 500;
}
.v-version-content-preview {
    background-color: var(--background-secondary);
    padding: var(--size-4-3);
    border-radius: var(--radius-m);
    overflow-y: auto;
    overflow-x: hidden;
    word-break: break-word;
    flex-grow: 1;
    transition: opacity 0.3s ease;
}
.v-version-content-preview.is-plaintext {
    white-space: pre-wrap;
    font-family: var(--font-monospace);
    font-size: var(--font-ui-smaller);
}
.v-version-content-preview p:first-child {
    margin-top: 0;
}
.v-version-content-preview p:last-child {
    margin-bottom: 0;
}

/* Empty State */
.v-empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: var(--size-4-8) var(--size-4-4);
    color: var(--text-muted);
    flex-grow: 1;
    animation: v-fade-in 0.5s ease;
}
.v-empty-state-icon {
    font-size: 3em;
    opacity: 0.3;
    margin-bottom: var(--size-4-3);
}

/* Skeleton Loader */
.v-history-entry.is-skeleton {
    pointer-events: none;
    background-color: var(--background-secondary);
    border-color: var(--background-modifier-border);
}
.is-skeleton .v-skeleton-item {
    background-color: var(--background-modifier-hover);
    border-radius: var(--radius-s);
    animation: v-pulse 1.5s infinite ease-in-out;
}
.is-skeleton .v-entry-header {
    gap: var(--size-4-3);
    margin-bottom: var(--size-4-2);
}
.is-skeleton .v-version-id {
    width: 40px;
    height: 20px;
    background-color: var(--background-modifier-hover);
    color: transparent;
}
.is-skeleton .v-version-name {
    height: 16px;
    width: 60%;
    background-color: var(--background-modifier-hover);
}
.is-skeleton .v-version-timestamp {
    height: 14px;
    width: 80px;
    background-color: var(--background-modifier-hover);
}
.is-skeleton .v-version-content {
    height: 14px;
    width: 40%;
    margin-top: var(--size-4-1);
    background-color: var(--background-modifier-hover);
}
.is-skeleton .v-entry-footer {
    display: none;
}

@keyframes v-pulse {
    0% { background-color: var(--background-modifier-hover); }
    50% { background-color: var(--background-modifier-border); }
    100% { background-color: var(--background-modifier-hover); }
}

@keyframes v-fade-in {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Scrollbar styling */
.v-history-list::-webkit-scrollbar,
.v-preview-panel::-webkit-scrollbar,
.v-settings-panel-content-wrapper::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}
.v-history-list::-webkit-scrollbar-thumb,
.v-preview-panel::-webkit-scrollbar-thumb,
.v-settings-panel-content-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-thumb-bg);
    border-radius: 3px;
}
.v-history-list::-webkit-scrollbar-track,
.v-preview-panel::-webkit-scrollbar-track,
.v-settings-panel-content-wrapper::-webkit-scrollbar-track {
    background-color: var(--scrollbar-bg);
}